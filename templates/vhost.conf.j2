<VirtualHost *:80>
  ServerName {{ item.server_name }}
{% if item.server_alias is defined and item.server_alias != '' %}
  ServerAlias {{ item.server_alias }}
{% endif %}
  ServerAdmin webmaster@{{ item.server_name }}

  CustomLog {{ apache_logs }}/{{ item.server_name }}-access.log combined
  ErrorLog {{ apache_logs }}/{{ item.server_name }}-error.log
  LogLevel warn

  DirectoryIndex index.html index.php

  DocumentRoot {{ item.vhost_home }}/public_html
  <Directory {{ item.vhost_home }}/public_html>
    Options Includes FollowSymLinks
    AllowOverride All

    # # 強制的にHTTPSとする
    # RewriteEngine on
    # RewriteCond %{SERVER_PORT} !^443$ [OR]
    # RewriteCond %{HTTPS} off
    # RewriteRule ^(.*)$ https://${HTTP_HOST}/$1 [R=302,L]

    <IfModule mod_authz_core.c>
      # Apache 2.4
      ### Local
      Order deny,allow
      <RequireAny>
        Require all granted
        Require ip ::1
      </RequireAny>
      ### Dev
      # AuthType Digest
      # AuthName "{{ item.server_name }} authentication"
      # AuthUserFile /etc/httpd/{{ item.server_name }}.htdigest
      # require valid-user
    </IfModule>
    <IfModule !mod_authz_core.c>
      # Apache 2.2
      Order Deny,Allow
      #Deny from All
      Allow from all
      Allow from ::1
      # AuthType Digest
      # AuthName "{{ item.server_name }} authentication"
      # AuthUserFile /etc/httpd/{{ item.server_name }}.htdigest
      # require valid-user
    </IfModule>
  </Directory>
</VirtualHost>

{% if item.use_ssl %}
<VirtualHost *:443>
  ServerName {{ item.server_name }}
{% if item.server_alias is defined and item.server_alias != '' %}
  ServerAlias {{ item.server_alias }}
{% endif %}
  ServerAdmin webmaster@{{ item.server_name }}

  CustomLog {{ apache_logs }}/{{ item.server_name }}-access.log combined
  ErrorLog {{ apache_logs }}/{{ item.server_name }}-error.log
  LogLevel warn

  SSLEngine on
  SSLProtocol all
{% if ssl_certificate_file is defined %}
  SSLCertificateFile      {{ ssl_certificate_file }}
{% endif %}
{% if ssl_certificate_key_file is defined %}
  SSLCertificateKeyFile   {{ ssl_certificate_key_file }}
{% endif %}
{% if ssl_certificate_chain_file is defined %}
  SSLCertificateChainFile {{ ssl_certificate_chain_file }}
{% endif %}
{% if ssl_cacertificate_file is defined %}
  SSLCACertificateFile    {{ ssl_cacertificate_file }}
{% endif %}
        
        
        
        

  DirectoryIndex index.html index.php

  DocumentRoot {{ item.vhost_home }}/public_html
  <Directory {{ item.vhost_home }}/public_html>
    Options Includes FollowSymLinks
    AllowOverride All

    <IfModule mod_authz_core.c>
      # Apache 2.4
      ### Local
      Order deny,allow
      <RequireAny>
        Require all granted
        Require ip ::1
      </RequireAny>
      ### Dev
      # AuthType Digest
      # AuthName "{{ item.server_name }} authentication"
      # AuthUserFile /etc/httpd/{{ item.server_name }}.htdigest
      # require valid-user
    </IfModule>
    <IfModule !mod_authz_core.c>
      # Apache 2.2
      Order Deny,Allow
      #Deny from All
      Allow from all
      Allow from ::1
      # AuthType Digest
      # AuthName "{{ item.server_name }} authentication"
      # AuthUserFile /etc/httpd/{{ item.server_name }}.htdigest
      # require valid-user
    </IfModule>
  </Directory>
</VirtualHost>
{% endif %}
